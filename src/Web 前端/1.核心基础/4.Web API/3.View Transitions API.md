---
title: View Transitions API
createTime: 2025/11/17 20:41:43
permalink: /web/core/sgesdkic/
---

## åŸºæœ¬ç®€ä»‹

View Transitions API æ˜¯ä¸€ä¸ªæµè§ˆå™¨åŸç”ŸåŠŸèƒ½ï¼Œå…è®¸åœ¨é¡µé¢çŠ¶æ€å˜åŒ–æ—¶åˆ›å»ºå¹³æ»‘è¿‡æ¸¡æ•ˆæœï¼Œæ— éœ€å¤æ‚çš„ CSS æˆ– JavaScript ä»£ç ã€‚å®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼å·¥ä½œï¼š

åœ¨æ›´æ–° DOM å‰æ•è·å½“å‰é¡µé¢çš„å¿«ç…§
æ‰§è¡Œ DOM æ›´æ–°
åˆ›å»ºæ–°æ—§è§†å›¾ä¹‹é—´çš„åŠ¨ç”»è¿‡æ¸¡

## å±æ€§æ–¹æ³•ä¼ªå…ƒç´ 

### startViewTransition()

`Document.startViewTransition(callback)`: å¼€å§‹ä¸€ä¸ªæ–°çš„è§†å›¾è¿‡æ¸¡ï¼Œå¹¶è¿”å›ä¸€ä¸ª ViewTransition å¯¹è±¡ï¼Œcallback é€šå¸¸ç”¨äºæ›´æ–° DOM çš„å›è°ƒå‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ª Promise

è¿™ä¸ªå›è°ƒå‡½æ•°åœ¨ API æˆªå–äº†å½“å‰é¡µé¢çš„å±å¹•æˆªå›¾åè¢«è°ƒç”¨ã€‚å½“å›è°ƒå‡½æ•°è¿”å›çš„ Promise å…‘ç°æ—¶ï¼Œè§†å›¾è¿‡æ¸¡å°†åœ¨ä¸‹ä¸€å¸§å¼€å§‹ã€‚å¦‚æœå›è°ƒå‡½æ•°è¿”å›çš„ Promise æ‹’ç»ï¼Œè¿‡æ¸¡å°†è¢«æ”¾å¼ƒã€‚

### ready

`viewTransition.ready`: åªè¯»å±æ€§æ˜¯ä¸€ä¸ª Promiseã€‚ä¼šåœ¨ä¼ªå…ƒç´ æ ‘è¢«åˆ›å»ºä¸”è¿‡æ¸¡åŠ¨ç”»å³å°†å¼€å§‹æ—¶å…‘ï¼ˆå³æ‰§è¡Œæ³¨å†Œçš„ then å›è°ƒï¼‰

å¦‚æœè§†å›¾è¿‡æ¸¡æ— æ³•å¼€å§‹ï¼Œready å°±ä¼šè¢«æ‹’ç»ã€‚è¿™å¯èƒ½æ˜¯ç”±äºé”™è¯¯çš„é…ç½®ï¼Œä¾‹å¦‚é‡å¤çš„ view-transition-nameï¼Œæˆ–è€…æ˜¯å› ä¸º Document.startViewTransition() çš„å›è°ƒå‡½æ•°æŠ›å‡ºå¼‚å¸¸æˆ–è¿”å›çš„ Promise è¢«æ‹’ç»ã€‚

### finished

`viewTransition.finished`: åªè¯»å±æ€§æ˜¯ä¸€ä¸ª Promiseã€‚ä¼šåœ¨è¿‡æ¸¡åŠ¨ç”»å®Œæˆï¼ˆæ–°çš„é¡µé¢è§†å›¾å¯¹ç”¨æˆ·å¯è§ä¸”å¯äº¤äº’ï¼‰æ—¶å…‘ç°

ä»…å½“ä¼ é€’ç»™ document.startViewTransition() çš„å›è°ƒå‡½æ•°æŠ›å‡ºå¼‚å¸¸æˆ–è¿”å›çš„ Promise è¢«æ‹’ç»æ—¶ï¼Œfinished æ‰ä¼šè¢«æ‹’ç»ï¼Œè¿™è¡¨ç¤ºé¡µé¢çš„æ–°çŠ¶æ€æœªè¢«åˆ›å»ºã€‚

å¦‚æœè¿‡æ¸¡åŠ¨ç”»æ— æ³•å¼€å§‹ï¼Œæˆ–åœ¨åŠ¨ç”»æœŸé—´ä½¿ç”¨ ViewTransition.skipTransition() è·³è¿‡äº†è¿‡æ¸¡åŠ¨ç”»ï¼Œé‚£ä¹ˆè§†å›¾è¿‡æ¸¡ä¾æ—§å¯ä»¥åˆ°è¾¾æœ€ç»ˆçŠ¶æ€ï¼Œå› æ­¤ finished ä¾æ—§ä¼šè¢«å…‘ç°ã€‚

### updateCallbackDone

`viewTransition.updateCallbackDone`: åªè¯»å±æ€§æ˜¯ä¸€ä¸ª Promiseã€‚startViewTransition(callback) å›è°ƒå‡½æ•°è¿”å›çš„ Promise å…‘ç°æ—¶ï¼Œè¯¥ Promise ä¹Ÿä¼šå…‘ç°ï¼Œå½“å›è°ƒå‡½æ•°è¿”å›çš„ Promise è¢«æ‹’ç»æ—¶ï¼Œè¯¥ Promise ä¹Ÿä¼šè¢«æ‹’ç»

å½“ä½ ä¸å…³å¿ƒè¿‡æ¸¡åŠ¨ç”»çš„æˆåŠŸæˆ–å¤±è´¥ï¼Œè€Œåªå…³å¿ƒ DOM æ˜¯å¦æ›´æ–°ä»¥åŠä½•æ—¶æ›´æ–°æ—¶ï¼ŒupdateCallbackDone éå¸¸æœ‰ç”¨

### skipTransition()

`viewTransition.skipTransition()`: è·³è¿‡è§†å›¾è¿‡æ¸¡çš„åŠ¨ç”»éƒ¨åˆ†ï¼Œä½†ä¸è·³è¿‡æ›´æ–° DOM çš„ startViewTransition(callback) å›è°ƒå‡½æ•°

### ä¼ªå…ƒç´ 

`::view-transition` - æ ¹ä¼ªå…ƒç´ 
`::view-transition-old(root)` - æ—§è§†å›¾çš„å¿«ç…§
`::view-transition-new(root)` - æ–°è§†å›¾çš„å¿«ç…§

## ç¤ºä¾‹-ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»

![ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»](https://upyun-oss.mu00.cn/2025/11/17/1763383647930.gif)

### åŸºç¡€å‡†å¤‡

1ã€åŸºæœ¬ç»“æ„

```html
<div class="toolbar">
  <el-switch
    class="theme-switch"
    :model-value="isDark"
    @click="onToggleClick"
    :active-icon="Moon"
    :inactive-icon="Sunny"
    active-text="æ·±è‰²"
    inactive-text="æµ…è‰²"
  ></el-switch>
</div>
```

2ã€åŸºæœ¬æ ·å¼

```css
.toolbar {
  position: sticky;
  top: 0;
  z-index: 10;
  padding: 12px 16px;
  display: flex;
  justify-content: flex-end;
  align-items: center;
  background-color: rgba(127, 127, 127, 0.05);
  backdrop-filter: saturate(180%) blur(8px);
  border-bottom: 1px solid var(--el-border-color);
}
```

3ã€è¾…åŠ©å‡½æ•°

```javascript
/**
 * åˆ‡æ¢äº®æš—ä¸»é¢˜
 */
function setupThemeClass(isDark) {
  document.documentElement.classList.toggle("dark", isDark);
  localStorage.setItem("theme", isDark ? "dark" : "light");
}

/**
 * è®¡ç®—è¿‡æ¸¡åŠ¨ç”»åŠå¾„
 * åˆ›å»ºä»ç‚¹å‡»ç‚¹å‘å¤–æ‰©æ•£çš„æ•ˆæœï¼Œéœ€è¦è®¡ç®—ä»ç‚¹å‡»ç‚¹åˆ°å±å¹•ä¸Šæœ€è¿œç‚¹çš„è·ç¦»
 */
function computeMaxRadius(x, y) {
  const maxX = Math.max(x, window.innerWidth - x);
  const maxY = Math.max(y, window.innerHeight - y);
  return Math.hypot(maxX, maxY);
}
```

### æ ¸å¿ƒæ­¥éª¤

**1ã€åˆ›å»ºè§†å›¾è¿‡æ¸¡åŠ¨ç”»**

```javascript
const transition = document.startViewTransition(async () => {
  // æ‰§è¡Œä¸»é¢˜åˆ‡æ¢é€»è¾‘
  isDark.value = !isDark.value;
  setupThemeClass(isDark.value);
});
```

**2ã€è®¡ç®—è¿‡æ¸¡åŠ¨ç”»åŠå¾„**

```javascript
// event ç‚¹å‡»äº‹ä»¶
const x = event.clientX;
const y = event.clientY;
const endRadius = computeMaxRadius(x, y);
```

**3ã€åˆ›å»ºåœ†å½¢å±•å¼€åŠ¨ç”»æ•ˆæœ**

```javascript
transition.ready.then(() => {
  const clipPath = [
    `circle(0px at ${x}px ${y}px)`,
    `circle(${endRadius}px at ${x}px ${y}px)`,
  ];
  document.documentElement.animate(
    {
      clipPath: isDark.value ? [...clipPath].reverse() : clipPath,
    },
    {
      duration: 450,
      fill: "both",
      easing: "ease-in",
      pseudoElement: isDark.value
        ? "::view-transition-old(root)"
        : "::view-transition-new(root)",
    }
  );
});
```

**4ã€è®¾ç½®ä¼ªå…ƒç´ çš„å±‚å é¡ºåº**

```css
/* 
  å…³é—­é»˜è®¤çš„ CSS åŠ¨ç”»å¹¶é˜²æ­¢æ–°æ—§è§†å›¾çŠ¶æ€ä»¥ä»»ä½•æ–¹å¼æ··åˆï¼ˆæ–°çŠ¶æ€ä»æ—§çŠ¶æ€ä¸Šæ–¹â€œæ“¦é™¤â€ï¼Œè€Œä¸æ˜¯è¿‡æ¸¡
*/
::view-transition-new(root),
::view-transition-old(root) {
  animation: none;
  mix-blend-mode: normal;
}

::view-transition-old(root) {
  z-index: 1;
}

::view-transition-new(root) {
  z-index: 2147483646;
}

html.dark::view-transition-old(root) {
  z-index: 2147483646;
}

html.dark::view-transition-new(root) {
  z-index: 1;
}
```

### å®Œæ•´ç¤ºä¾‹

```html :collapsed-lines
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ·±è‰²æ¨¡å¼åˆ‡æ¢åŠ¨ç”»ï¼ˆä¿®æ­£ç‰ˆï¼‰</title>

    <!-- Element Plus æ ·å¼ä¸æš—è‰²å˜é‡ -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/dist/index.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-plus/theme-chalk/dark/css-vars.css"
    />

    <style>
      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: var(--el-bg-color);
        color: var(--el-text-color-primary);
        transition: color 300ms ease, background-color 300ms ease;
        font-family: var(--el-font-family), -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      }

      .toolbar {
        position: sticky;
        top: 0;
        z-index: 10;
        padding: 12px 16px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        background-color: rgba(127, 127, 127, 0.05);
        backdrop-filter: saturate(180%) blur(8px);
        border-bottom: 1px solid var(--el-border-color);
      }

      .container {
        max-width: 960px;
        margin: 24px auto;
        padding: 0 16px;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="toolbar">
        <el-switch
          class="theme-switch"
          :model-value="isDark"
          @click="onToggleClick"
          :active-icon="Moon"
          :inactive-icon="Sunny"
          active-text="æ·±è‰²"
          inactive-text="æµ…è‰²"
        ></el-switch>
      </div>

      <div class="container">
        <el-space direction="vertical" size="large" style="width: 100%">
          <el-card shadow="hover">
            <template #header>
              <span>ç¤ºä¾‹å¡ç‰‡</span>
            </template>
            <div>å½“å‰ä¸»é¢˜ï¼š{{ isDark ? 'æ·±è‰²' : 'æµ…è‰²' }}</div>
            <el-divider></el-divider>
            <el-space wrap>
              <el-button type="primary">ä¸»è¦æŒ‰é’®</el-button>
              <el-button type="success">æˆåŠŸæŒ‰é’®</el-button>
              <el-button type="warning">è­¦å‘ŠæŒ‰é’®</el-button>
              <el-button type="danger">å±é™©æŒ‰é’®</el-button>
              <el-button>é»˜è®¤æŒ‰é’®</el-button>
            </el-space>
          </el-card>

          <el-switch
            class="theme-switch"
            :model-value="isDark"
            @click="onToggleClick"
            :active-icon="Moon"
            :inactive-icon="Sunny"
            active-text="æ·±è‰²"
            inactive-text="æµ…è‰²"
          ></el-switch>

          <el-alert
            title="è¿™æ˜¯ä¸€æ¡æˆåŠŸæç¤º"
            type="success"
            show-icon
          ></el-alert>
          <el-alert title="è¿™æ˜¯ä¸€æ¡ä¿¡æ¯æç¤º" type="info" show-icon></el-alert>
          <el-alert
            title="è¿™æ˜¯ä¸€æ¡è­¦å‘Šæç¤º"
            type="warning"
            show-icon
          ></el-alert>
          <el-alert title="è¿™æ˜¯ä¸€æ¡é”™è¯¯æç¤º" type="error" show-icon></el-alert>
        </el-space>
      </div>
    </div>

    <!-- Vue 3 & Element Plus CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.min.js"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>

    <script>
      const { createApp, ref, onMounted, nextTick } = Vue;

      function setupThemeClass(isDark) {
        document.documentElement.classList.toggle("dark", isDark);
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      function computeMaxRadius(x, y) {
        const maxX = Math.max(x, window.innerWidth - x);
        const maxY = Math.max(y, window.innerHeight - y);
        return Math.hypot(maxX, maxY);
      }

      const app = createApp({
        setup() {
          const isDark = ref(false);

          const initTheme = () => {
            const saved = localStorage.getItem("theme");
            const preferDark =
              window.matchMedia &&
              window.matchMedia("(prefers-color-scheme: dark)").matches;
            console.log(preferDark);

            const next = saved ? saved === "dark" : preferDark;
            isDark.value = next;
            setupThemeClass(next);
          };

          function onToggleClick(event) {
            const isAppearanceTransition =
              document.startViewTransition &&
              !window.matchMedia("(prefers-reduced-motion: reduce)").matches;
            if (!isAppearanceTransition || !event) {
              isDark.value = !isDark.value;
              return;
            }
            const x = event.clientX;
            const y = event.clientY;
            const endRadius = computeMaxRadius(x, y);
            console.log(event);

            const transition = document.startViewTransition(async () => {
              isDark.value = !isDark.value;
              setupThemeClass(isDark.value);
              // await nextTick()
            });
            console.log(endRadius, "ğŸˆ");

            transition.ready.then(() => {
              const clipPath = [
                `circle(0px at ${x}px ${y}px)`,
                `circle(${endRadius}px at ${x}px ${y}px)`,
              ];
              document.documentElement.animate(
                {
                  clipPath: isDark.value ? [...clipPath].reverse() : clipPath,
                },
                {
                  duration: 450,
                  fill: "both",
                  easing: "ease-in",
                  pseudoElement: isDark.value
                    ? "::view-transition-old(root)"
                    : "::view-transition-new(root)",
                }
              );
            });
          }

          onMounted(initTheme);

          const { Moon, Sunny } = ElementPlusIconsVue;

          return { isDark, onToggleClick, Moon, Sunny };
        },
      });

      // å…¨å±€æ³¨å†Œ Element Plus ä¸å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
      Object.entries(ElementPlusIconsVue).forEach(([key, component]) => {
        app.component(key, component);
      });
      app.use(ElementPlus);
      app.mount("#app");
    </script>
  </body>
</html>
<style>
  ::view-transition-new(root),
  ::view-transition-old(root) {
    animation: none;
    mix-blend-mode: normal;
  }

  ::view-transition-old(root) {
    z-index: 1;
  }

  ::view-transition-new(root) {
    z-index: 2147483646;
  }

  html.dark::view-transition-old(root) {
    z-index: 2147483646;
  }

  html.dark::view-transition-new(root) {
    z-index: 1;
  }

  input::placeholder,
  textarea::placeholder {
    opacity: 1;
  }
</style>
```
